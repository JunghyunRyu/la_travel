<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LA 가족 여행 플래너 (Royal Palace Westwood)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fdfaf6; /* Warm neutral background */
            color: #333;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        .tab-active {
            border-bottom: 3px solid #f59e0b; /* Amber-500 */
            color: #d97706; /* Amber-600 */
            font-weight: 700;
        }
        .tab-inactive {
            color: #6b7280;
            border-bottom: 3px solid transparent;
        }
        .tab-inactive:hover {
            color: #374151;
            border-bottom: 3px solid #e5e7eb;
        }
    </style>
    <!-- Chosen Palette: Warm Neutrals with Sunny Amber & Pacific Blue accents (Calm & Family Friendly) -->
    <!-- Application Structure Plan: 
         1. Header: Trip Summary & Key constraints (Child-friendly, Safety).
         2. Interactive Dashboard: 
            - Day Tabs (Day 1, 2, 3) to switch context.
            - Left Column: Chronological Itinerary Cards with "Child Focus" tips.
            - Right Column: Dynamic visualizations.
                a. "Route Map" (Plotly Scatter) showing relative distances from Westwood base.
                b. "Kid's Energy Forecast" (Chart.js Line) predicting fatigue levels based on activity intensity.
         3. Utility Section: Packing Checklist & Safety Tips.
         4. Rationale: Structure allows parents to visualize the flow of the day, understand logistics (distance), and manage the child's condition (energy), which are the user's main concerns. -->
    <!-- Visualization & Content Choices:
         1. Plotly Scatter Plot: To visualize the driving range and direction from the hotel without using heavy Maps APIs. Goal: Show proximity and safety.
         2. Chart.js Line Chart: "Energy Forecast". Goal: Help parents plan rest times. Interaction: Updates per day.
         3. Interactive Timeline: Text cards. Goal: Details. Interaction: Click to expand details.
         4. Checklist: Interactive HTML. Goal: Preparation.
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-[#fdfaf6] min-h-screen pb-12">

    <!-- Header Section -->
    <header class="bg-white card-shadow sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">LA 가족 여행 플래너 <span class="text-amber-500 text-lg font-normal ml-2">with 5세 아이</span></h1>
                <p class="text-sm text-gray-500">Royal Palace Westwood Base | 4월 11일 - 14일</p>
            </div>
            <div class="hidden md:flex items-center gap-3">
                <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">렌터카 이동</span>
                <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">안전 지역 위주</span>
                <span class="inline-block bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">아이 맞춤형</span>
                <a href="joshua.html" class="ml-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm px-4 py-2 rounded-lg transition-colors font-medium">
                    🏜️ 조슈아트리 숙소
                </a>
                <a href="la_family_trip_planner.html" class="bg-amber-500 hover:bg-amber-600 text-white text-sm px-4 py-2 rounded-lg transition-colors font-medium">
                    📅 전체 일정 보기
                </a>
            </div>
        </div>
        <!-- Mobile Navigation -->
        <div class="md:hidden px-4 pb-3 flex gap-2">
            <a href="joshua.html" class="flex-1 text-center bg-indigo-600 hover:bg-indigo-700 text-white text-sm px-3 py-2 rounded-lg transition-colors font-medium">
                🏜️ 조슈아트리
            </a>
            <a href="la_family_trip_planner.html" class="flex-1 text-center bg-amber-500 hover:bg-amber-600 text-white text-sm px-3 py-2 rounded-lg transition-colors font-medium">
                📅 전체 일정
            </a>
        </div>
    </header>

    <!-- Main Container -->
    <main class="max-w-6xl mx-auto px-4 mt-8 grid grid-cols-1 lg:grid-cols-12 gap-8">

        <!-- Introduction -->
        <div class="lg:col-span-12 mb-4">
            <div class="bg-white p-6 rounded-xl card-shadow border-l-4 border-amber-500">
                <h2 class="text-xl font-bold mb-2">여행 개요 및 전략</h2>
                <p class="text-gray-600 leading-relaxed">
                    이 대시보드는 5세 아이와 함께하는 3박 4일 LA 여행을 위해 최적화되었습니다. 
                    <strong>Royal Palace Westwood</strong> 호텔을 베이스캠프로 하여, 치안이 우수한 Westside와 Mid-City 지역을 중심으로 동선을 짰습니다.
                    혼잡한 명예의 거리를 피하고, 아이의 체력을 고려하여 <strong>'오전 활동 - 여유로운 점심 - 오후 랜드마크 - 빠른 귀가'</strong> 패턴을 유지합니다.
                    아래 탭을 눌러 날짜별 세부 동선과 예상 체력 소모를 확인하세요.
                </p>
            </div>
        </div>

        <!-- Left Column: Navigation & Itinerary -->
        <div class="lg:col-span-7 flex flex-col gap-6">
            
            <!-- Day Navigation -->
            <div class="flex space-x-1 border-b border-gray-200">
                <button onclick="switchDay(0)" id="tab-0" class="tab-active flex-1 py-4 px-1 text-center text-sm md:text-base transition-colors duration-200">
                    Day 1<br><span class="text-xs font-normal">4/11 (토) - 예술과 바다</span>
                </button>
                <button onclick="switchDay(1)" id="tab-1" class="tab-inactive flex-1 py-4 px-1 text-center text-sm md:text-base transition-colors duration-200">
                    Day 2<br><span class="text-xs font-normal">4/12 (일) - 공원과 랜드마크</span>
                </button>
                <button onclick="switchDay(2)" id="tab-2" class="tab-inactive flex-1 py-4 px-1 text-center text-sm md:text-base transition-colors duration-200">
                    Day 3<br><span class="text-xs font-normal">4/13 (월) - 유니버셜 스튜디오</span>
                </button>
            </div>

            <!-- Dynamic Itinerary Content -->
            <div id="itinerary-container" class="space-y-4">
                <!-- Content injected by JS -->
            </div>

            <!-- Smart Tips Section -->
            <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                <h3 class="font-bold text-blue-900 mb-3 flex items-center">
                    <span>💡 5세 아이와 함께하는 여행 꿀팁</span>
                </h3>
                <ul class="space-y-2 text-sm text-blue-800" id="daily-tips">
                    <!-- Tips injected by JS -->
                </ul>
            </div>
        </div>

        <!-- Right Column: Visualizations & Analytics -->
        <div class="lg:col-span-5 flex flex-col gap-6">
            
            <!-- Location Map Visualization -->
            <div class="bg-white p-5 rounded-xl card-shadow">
                <div class="mb-4">
                    <h3 class="font-bold text-gray-800 text-lg">🗺️ 오늘의 이동 동선 (Relative Map)</h3>
                    <p class="text-xs text-gray-500">호텔(중심) 기준 주요 방문지 위치 및 거리감</p>
                </div>
                <div id="map-plot" class="w-full h-[300px] bg-gray-50 rounded-lg"></div>
            </div>

            <!-- Kid's Energy Forecast Chart -->
            <div class="bg-white p-5 rounded-xl card-shadow">
                <div class="mb-4">
                    <h3 class="font-bold text-gray-800 text-lg">🔋 아이 체력 예측 그래프</h3>
                    <p class="text-xs text-gray-500">시간대별 예상 피로도 및 휴식 필요 구간</p>
                </div>
                <div class="chart-container">
                    <canvas id="energyChart"></canvas>
                </div>
            </div>

            <!-- Interactive Checklist -->
            <div class="bg-white p-5 rounded-xl card-shadow">
                <h3 class="font-bold text-gray-800 text-lg mb-4">🎒 오늘의 필수 준비물</h3>
                <div id="checklist-container" class="space-y-2">
                    <!-- Checklist injected by JS -->
                </div>
            </div>

        </div>

        <!-- Accommodation & Map Section -->
        <div class="lg:col-span-12 mt-4">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Hotel Info Card -->
                <div class="bg-white p-6 rounded-xl card-shadow">
                    <h3 class="font-bold text-gray-800 text-lg mb-4">🏨 숙소 정보 (Royal Palace Westwood)</h3>
                    <div class="space-y-3">
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 flex-shrink-0">
                                <span class="text-lg">📍</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">1052 Tiverton Avenue</p>
                                <p class="text-sm text-gray-500">Los Angeles, CA 90024</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 flex-shrink-0">
                                <span class="text-lg">📅</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">4월 11일 ~ 14일 (3박)</p>
                                <p class="text-sm text-gray-500">체크인 15:00 / 체크아웃 11:00</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center text-amber-600 flex-shrink-0">
                                <span class="text-lg">✨</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">주요 편의시설</p>
                                <p class="text-sm text-gray-500">무료 주차, 전자레인지, 냉장고, 퀸베드 2개</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100 flex flex-wrap gap-2">
                        <a href="https://www.booking.com/hotel/us/royal-palace-westwood.html" target="_blank"
                           class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors">
                            <span class="mr-1">🔗</span> Booking.com
                        </a>
                        <a href="https://www.expedia.com/Los-Angeles-Hotels-Royal-Palace-Westwood.h9083.Hotel-Information" target="_blank"
                           class="inline-flex items-center px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white text-sm rounded-lg transition-colors">
                            <span class="mr-1">🔗</span> Expedia
                        </a>
                        <a href="https://www.google.com/maps/place/Royal+Palace+Westwood/@34.0628,-118.4467,17z" target="_blank"
                           class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition-colors">
                            <span class="mr-1">📍</span> Google Maps
                        </a>
                    </div>
                </div>

                <!-- Map Embed -->
                <div class="bg-white p-4 rounded-xl card-shadow">
                    <h3 class="font-bold text-gray-800 text-lg mb-3">🗺️ 호텔 위치 & 주변 지도</h3>
                    <div class="rounded-lg overflow-hidden border border-gray-200">
                        <iframe
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3305.1!2d-118.4467!3d34.0628!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x80c2bc85896d0e93%3A0x5f0b0f2b0f9c7d1a!2s1052%20Tiverton%20Ave%2C%20Los%20Angeles%2C%20CA%2090024!5e0!3m2!1sen!2sus!4v1704067200000!5m2!1sen!2sus"
                            width="100%"
                            height="280"
                            style="border:0;"
                            allowfullscreen=""
                            loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade">
                        </iframe>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-xs">
                        <a href="https://www.google.com/maps/dir//UCLA/@34.0689,-118.4452,15z" target="_blank"
                           class="flex items-center justify-center gap-1 p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            <span>🎓</span> UCLA (도보 10분)
                        </a>
                        <a href="https://www.google.com/maps/dir//Trader+Joe's,+1000+Glendon+Ave,+Los+Angeles,+CA" target="_blank"
                           class="flex items-center justify-center gap-1 p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            <span>🛒</span> Trader Joe's (도보 5분)
                        </a>
                        <a href="https://www.google.com/maps/dir//UCLA+Medical+Center/@34.0667,-118.4456,16z" target="_blank"
                           class="flex items-center justify-center gap-1 p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            <span>🏥</span> UCLA 병원 (도보 8분)
                        </a>
                        <a href="https://www.google.com/maps/dir//Westwood+Recreation+Center/@34.0526,-118.4396,16z" target="_blank"
                           class="flex items-center justify-center gap-1 p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            <span>🛝</span> Aidan's Place (차 5분)
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Safety & Driving Info (Bottom Full Width) -->
        <div class="lg:col-span-12 mt-4">
            <div class="bg-gray-800 text-white p-6 rounded-xl shadow-lg">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                    <h3 class="text-lg font-bold text-amber-400">🚗 LA 렌터카 운전 및 안전 수칙</h3>
                    <button onclick="toggleSafetyDetails()" class="text-sm bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded mt-2 md:mt-0 transition">상세 보기 / 접기</button>
                </div>
                <div id="safety-details" class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-300">
                    <div>
                        <h4 class="font-bold text-white mb-2">운전 주의사항</h4>
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>HOV 레인 (카풀):</strong> 2인 이상 탑승 시 이용 가능. 다이아몬드 표시 확인.</li>
                            <li><strong>STOP 사인:</strong> 3초간 완전히 정지 후 출발 (엄격 단속).</li>
                            <li><strong>비보호 좌회전:</strong> 녹색 신호 시, 맞은편 직진 차량이 없을 때 좌회전 가능.</li>
                            <li><strong>스쿨버스:</strong> 스쿨버스가 'STOP' 표시를 펴면 양방향 모두 정지해야 함.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-white mb-2">치안 & 주차</h4>
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>차량 내 물품:</strong> 절대로 차 안에 가방, 동전, 옷 등을 보이게 두지 마세요 (창문 파손 절도 주의).</li>
                            <li><strong>주차:</strong> 길거리 주차 시 표지판(주차 가능 시간, 청소 시간) 필독. 가능한 유료 주차장 이용 권장.</li>
                            <li><strong>피해야 할 곳:</strong> 밤늦은 시간의 다운타운 LA, 할리우드 대로 뒷골목.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="text-center text-gray-400 text-sm py-8 mt-8 border-t border-gray-200">
        <p>4월 14일은 귀국일입니다. 안전한 비행 되세요! ✈️</p>
    </footer>

    <script>
        // --- Data Definitions ---

        const dayData = [
            {
                // Day 1: 조슈아트리에서 LA 이동 + 도착일
                title: "Day 1: LA 도착 & 산타모니카 (Westside)",
                date: "4월 11일 (토)",
                summary: "조슈아트리에서 LA로 이동하는 날. 체크인 후 여유롭게 산타모니카 해변을 즐깁니다. 장거리 이동 후라 무리하지 않습니다.",
                activities: [
                    { time: "09:00", title: "조슈아트리 국립공원", desc: "Hidden Valley Trail(1마일, 평탄) 산책. 아이들이 바위 틈 탐험하기 좋음. Skull Rock 사진 촬영.", type: "Walk", icon: "🏜️" },
                    { time: "12:00", title: "LA로 이동 시작", desc: "점심 후 웨스트우드로 출발. 주말 LA 진입 교통량 주의 (약 2.5~3시간 소요).", type: "Drive", icon: "🚗" },
                    { time: "16:00", title: "Royal Palace Westwood 체크인", desc: "무료 주차! 전자레인지/냉장고 완비. 최상층 & 도로 반대편 방 요청(소음 차단).", type: "Rest", icon: "🏨" },
                    { time: "17:30", title: "Trader Joe's 장보기", desc: "도보 5분. 아이 간식(치즈스틱, 요거트, 과일), 우유, 햇반 구매.", type: "Shop", icon: "🛒" },
                    { time: "19:00", title: "산타모니카 피어 (선택)", desc: "체력 되면 Pacific Park 관람차 탑승. 바닷바람 쌀쌀하니 겉옷 필수!", type: "Play", icon: "🎡" }
                ],
                tips: [
                    "조슈아트리 밤 기온은 10°C 이하! 아침에 방풍 재킷 챙기세요.",
                    "Royal Palace Westwood는 UCLA 인근으로 LA에서 가장 안전한 지역 중 하나입니다.",
                    "도보 5분 내 Target, Trader Joe's, Ralphs 마트가 있어 아이 용품 조달이 편리합니다.",
                    "UCLA Mattel Children's Hospital이 도보 5~10분 거리 (24시간 소아 응급실)."
                ],
                mapPoints: [
                    { x: 0, y: 0, name: "호텔(Westwood)", color: "#10b981", size: 20 },
                    { x: 6, y: 4, name: "조슈아트리", color: "#d97706", size: 15 },
                    { x: -4, y: -2, name: "산타모니카", color: "#ef4444", size: 15 },
                    { x: -0.5, y: -0.2, name: "Trader Joe's", color: "#f59e0b", size: 10 }
                ],
                energyLabels: ["09:00", "12:00", "15:00", "17:00", "19:00", "21:00"],
                energyData: [85, 70, 50, 60, 45, 20],
                checklist: [
                    "호텔 바우처 & 예약 확인서", "아이 방풍 재킷 (사막 아침 추위)", "선글라스 및 선크림", "백색 소음기 앱 (호텔 소음 대비)"
                ]
            },
            {
                // Day 2: 게티 센터 & 그리피스 천문대 (일요일 필수!)
                title: "Day 2: 예술 & 천문대 (일요일 필수!)",
                date: "4월 12일 (일)",
                summary: "그리피스 천문대는 월요일 휴관! 반드시 일요일에 방문합니다. 게티 센터와 놀이터도 함께.",
                activities: [
                    { time: "09:00", title: "UCLA 식물원 산책", desc: "Mildred E. Mathias Botanical Garden. 무료 입장! 거북이와 잉어 찾기 놀이. 호텔 바로 앞.", type: "Walk", icon: "🌿" },
                    { time: "10:00", title: "게티 센터 (The Getty Center)", desc: "트램 타고 올라가기! 정원에서 아이가 뛰어놀기 좋음. (입장 무료, 주차 $25, 사전예약 필수)", type: "Walk", icon: "🏛️" },
                    { time: "13:00", title: "Granville에서 점심", desc: "Kid's Mac & Cheese, 버터 파스타 등 키즈 메뉴 다양. 분위기 좋고 아이 떠들어도 OK.", type: "Food", icon: "🍝" },
                    { time: "14:00", title: "호텔 휴식 & 낮잠", desc: "오후 더위 피하기. 내일 유니버셜 위해 체력 비축!", type: "Rest", icon: "😴" },
                    { time: "15:30", title: "Aidan's Place 놀이터", desc: "Westwood Rec Center 내 포용적 놀이터. 충격흡수 바닥, 안전 펜스. 모래놀이 세트 챙기기!", type: "Play", icon: "🛝" },
                    { time: "17:00", title: "그리피스 천문대 (월요일 휴관!)", desc: "할리우드 사인 조망 & 우주 전시. 주말 저녁 주차난 심함 - 일찍 도착하거나 DASH 버스 이용.", type: "Walk", icon: "🔭" },
                    { time: "19:00", title: "In-N-Out Burger 저녁", desc: "LA 필수 코스! 아이에겐 Plain Burger 주문. 매장 시끄러워서 아이 울어도 전혀 문제없음.", type: "Food", icon: "🍔" }
                ],
                tips: [
                    "⚠️ 그리피스 천문대는 월요일 휴관! 반드시 오늘(일요일) 방문하세요.",
                    "게티 센터는 사전 예약 필수입니다. 유모차 대여 가능.",
                    "Aidan's Place 놀이터는 모든 아이를 위한 포용적 설계로 바닥이 충격흡수 고무 소재입니다.",
                    "In-N-Out에서 'Plain Burger'(패티+빵만) 주문 가능 - 소스 싫어하는 아이에게 딱!"
                ],
                mapPoints: [
                    { x: 0, y: 0, name: "호텔(Westwood)", color: "#10b981", size: 20 },
                    { x: -0.5, y: 3, name: "게티 센터", color: "#3b82f6", size: 15 },
                    { x: -0.3, y: -0.8, name: "놀이터", color: "#ec4899", size: 12 },
                    { x: 7, y: 5, name: "그리피스 천문대", color: "#ef4444", size: 15 }
                ],
                energyLabels: ["09:00", "11:00", "13:00", "15:00", "17:00", "19:00"],
                energyData: [95, 75, 65, 80, 60, 35],
                checklist: [
                    "게티 센터 사전 예약 확인", "편안한 운동화 (많이 걷습니다)", "휴대용 유모차", "모래놀이 세트", "카메라/삼각대 (천문대 야경)"
                ]
            },
            {
                // Day 3: 유니버셜 스튜디오 (월요일 - 주말보다 한산)
                title: "Day 3: 유니버셜 스튜디오 할리우드",
                date: "4월 13일 (월)",
                summary: "월요일이라 주말보다 한산! 5세 아이 눈높이에 맞춰 '슈퍼 닌텐도 월드'와 '미니언즈' 위주로 공략합니다.",
                activities: [
                    { time: "08:00", title: "호텔 출발", desc: "웨스트우드에서 30~40분. 출근 정체 반대 방향이라 수월. 주차비 약 $30.", type: "Drive", icon: "🚗" },
                    { time: "09:00", title: "Super Nintendo World 직행!", desc: "입장 즉시 Lower Lot으로! Mario Kart: Bowser's Challenge 5세 탑승 가능(보호자 동반).", type: "Play", icon: "🍄" },
                    { time: "10:30", title: "Power-Up Band 체험", desc: "$40 손목밴드 구매하면 곳곳의 블록을 치며 코인 모으기! 아이 만족도 최고.", type: "Play", icon: "🎮" },
                    { time: "11:00", title: "Toadstool Cafe 점심", desc: "당일 오전 QR코드로 미리 예약 필수! 마리오 테마 귀여운 음식들.", type: "Food", icon: "🍄" },
                    { time: "12:30", title: "Minion Land 탐험", desc: "Despicable Me 라이드 + Super Silly Fun Land(물놀이 구역). 여벌 옷 준비!", type: "Play", icon: "🟡" },
                    { time: "14:00", title: "Studio Tour (1시간)", desc: "트램 타고 영화 세트장 투어. 다리 쉬기 좋음! 킹콩/분노의질주 구간은 소리 크니 미리 설명.", type: "Walk", icon: "🚌" },
                    { time: "15:30", title: "The Secret Life of Pets", desc: "강아지 로봇 라이드. 아이들이 정말 좋아함! DreamWorks Theatre 쿵푸팬더 4D도.", type: "Play", icon: "🐕" },
                    { time: "18:00", title: "CityWalk 저녁 & 퇴장", desc: "유니버셜 시티워크에서 마지막 저녁. 기념품 쇼핑 후 호텔 복귀.", type: "Food", icon: "🍽️" }
                ],
                tips: [
                    "입장 즉시 에스컬레이터 타고 Lower Lot의 닌텐도 월드로 직행하세요!",
                    "Toadstool Cafe는 당일 오전 QR코드 예약 필수 - 대기가 매우 깁니다.",
                    "Super Silly Fun Land는 물놀이 구역이니 여벌 옷이나 수건 준비하세요.",
                    "Studio Tour 중 킹콩, 분노의 질주 구간은 소리가 크고 흔들림이 심해요. 미리 아이에게 설명해주세요.",
                    "⚠️ 내일 귀국일! 오늘 저녁 짐 미리 싸두세요."
                ],
                mapPoints: [
                    { x: 0, y: 0, name: "호텔(Westwood)", color: "#10b981", size: 20 },
                    { x: 5, y: 6, name: "유니버셜 스튜디오", color: "#8b5cf6", size: 25 }
                ],
                energyLabels: ["09:00", "11:00", "13:00", "15:00", "17:00", "19:00"],
                energyData: [100, 85, 55, 50, 35, 10],
                checklist: [
                    "입장권 QR코드 캡처 (앱 설치)", "보조배터리 20000mAh+", "여벌 옷 (물놀이 대비)", "간식 (그래놀라바, 젤리)", "귀국 짐 미리 정리"
                ]
            }
        ];

        let currentDayIndex = 0;
        let energyChartInstance = null;

        // --- Core Logic ---

        // Fixed: Renamed from renderDay to switchDay to match HTML onclick events
        function switchDay(index) {
            currentDayIndex = index;
            const data = dayData[index];

            // 1. Update Tabs
            [0, 1, 2].forEach(i => {
                const btn = document.getElementById(`tab-${i}`);
                if (i === index) {
                    btn.className = "tab-active flex-1 py-4 px-1 text-center text-sm md:text-base transition-colors duration-200 bg-amber-50 rounded-t-lg";
                } else {
                    btn.className = "tab-inactive flex-1 py-4 px-1 text-center text-sm md:text-base transition-colors duration-200 hover:bg-gray-50";
                }
            });

            // 2. Update Itinerary Cards
            const container = document.getElementById('itinerary-container');
            container.innerHTML = '';
            data.activities.forEach(act => {
                const card = document.createElement('div');
                card.className = "bg-white p-4 rounded-lg border border-gray-100 card-shadow flex gap-4 hover:border-amber-300 transition-all";
                card.innerHTML = `
                    <div class="flex flex-col items-center justify-center min-w-[60px]">
                        <span class="text-2xl">${act.icon}</span>
                        <span class="text-xs font-bold text-gray-500 mt-1">${act.time}</span>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800">${act.title}</h4>
                        <p class="text-sm text-gray-600 mt-1">${act.desc}</p>
                    </div>
                `;
                container.appendChild(card);
            });

            // 3. Update Tips
            const tipsContainer = document.getElementById('daily-tips');
            tipsContainer.innerHTML = data.tips.map(tip => `<li class="flex items-start"><span class="mr-2">•</span>${tip}</li>`).join('');

            // 4. Update Checklist
            const checkContainer = document.getElementById('checklist-container');
            checkContainer.innerHTML = data.checklist.map((item, i) => `
                <div class="flex items-center p-2 rounded hover:bg-gray-50 cursor-pointer" onclick="toggleCheck(this)">
                    <div class="w-5 h-5 border-2 border-amber-400 rounded mr-3 flex items-center justify-center text-white check-box transition-colors">✓</div>
                    <span class="text-sm text-gray-700 select-none">${item}</span>
                </div>
            `).join('');

            // 5. Update Map (Plotly)
            updateMap(data.mapPoints);

            // 6. Update Energy Chart (Chart.js)
            updateEnergyChart(data.energyLabels, data.energyData);
        }

        // --- Visualization Functions ---

        function updateMap(points) {
            const trace = {
                x: points.map(p => p.x),
                y: points.map(p => p.y),
                text: points.map(p => p.name),
                mode: 'markers+text',
                type: 'scatter',
                textposition: 'top center',
                marker: {
                    size: points.map(p => p.size),
                    color: points.map(p => p.color),
                    line: { width: 2, color: '#fff' }
                },
                hoverinfo: 'text'
            };

            const layout = {
                margin: { t: 20, b: 20, l: 20, r: 20 },
                xaxis: { showgrid: true, zeroline: false, showticklabels: false, range: [-6, 8] },
                yaxis: { showgrid: true, zeroline: false, showticklabels: false, range: [-4, 8] },
                dragmode: false,
                paper_bgcolor: '#f9fafb',
                plot_bgcolor: '#f9fafb',
                showlegend: false
            };

            const config = { responsive: true, displayModeBar: false };
            Plotly.newPlot('map-plot', [trace], layout, config);
        }

        function updateEnergyChart(labels, data) {
            const ctx = document.getElementById('energyChart').getContext('2d');
            
            if (energyChartInstance) {
                energyChartInstance.destroy();
            }

            // Create gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(245, 158, 11, 0.5)'); // Amber
            gradient.addColorStop(1, 'rgba(245, 158, 11, 0.0)');

            energyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '아이 에너지 레벨',
                        data: data,
                        borderColor: '#f59e0b',
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#d97706',
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let val = context.raw;
                                    if (val > 80) return `⚡ 에너지 뿜뿜! (${val}%)`;
                                    if (val > 50) return `🙂 활동하기 좋아요 (${val}%)`;
                                    if (val > 20) return `🥱 휴식이 필요해요 (${val}%)`;
                                    return `😴 졸려요... (${val}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            display: true,
                            title: { display: true, text: '활력도 (%)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        // --- Utility Functions ---

        function toggleCheck(el) {
            const box = el.querySelector('.check-box');
            const text = el.querySelector('span');
            
            if (box.classList.contains('bg-amber-500')) {
                box.classList.remove('bg-amber-500');
                text.classList.remove('line-through', 'text-gray-400');
            } else {
                box.classList.add('bg-amber-500');
                text.classList.add('line-through', 'text-gray-400');
            }
        }

        function toggleSafetyDetails() {
            const details = document.getElementById('safety-details');
            if (details.style.display === 'none') {
                details.style.display = 'grid';
            } else {
                details.style.display = 'none';
            }
        }

        // Initialize
        window.onload = () => {
            switchDay(0); // Fixed: Changed from renderDay to switchDay
            // Default show details for safety on large screens
            if (window.innerWidth < 768) {
                document.getElementById('safety-details').style.display = 'none';
            }
        };

        // Resize handler for charts
        window.addEventListener('resize', () => {
            if(energyChartInstance) energyChartInstance.resize();
            Plotly.Plots.resize('map-plot');
        });

    </script>
</body>
</html>
